using BarbarianSim.Config;

namespace BarbarianSim.Aspects;

public class ExploitersAspect : Aspect
{
    // You have 20%[+] increased Crowd Control Duration. While enemies are Unstoppable, you deal [20 - 40]%[x] increased damage to them.
    public double Damage { get; set; }
    public const double CROWD_CONTROL_DURATION = 20;

    public ExploitersAspect(SimLogger log) => _log = log;

    private readonly SimLogger _log;

    public virtual double GetCrowdControlDuration(SimulationState state)
    {
        if (IsAspectEquipped(state))
        {
            _log.Verbose($"Exploiters Aspect Crowd Control Duration Bonus = {CROWD_CONTROL_DURATION:F2}%");
            return CROWD_CONTROL_DURATION;
        }

        return 0;
    }

    public virtual double GetDamageBonus(SimulationState state, EnemyState enemy)
    {
        if (IsAspectEquipped(state) && enemy.IsUnstoppable())
        {
            var result = 1 + (Damage / 100.0);
            _log.Verbose($"Exploiters Aspect Damage Bonus = {result:F2}x");

            return result;
        }

        return 1;
    }
}
